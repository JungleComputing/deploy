<project name="deploy" default="build" basedir=".">
    <description>
	Build file for the deploy project
    </description>

    <property name="version" value="" />

    <property name="dist-name" value="${ant.project.name}${version}" />

    <!-- Import environment properties -->

    <property environment="env" />
    <property name="gat" location="${env.GAT_LOCATION}" />
    <property name="ipl" location="${env.IPL_HOME}" />

    <target name="build" description="Build with included JavaGAT and IPL" depends="clean,copy-included,compile,javadoc" />

    <target name="build-external" description="Build with external JavaGAT and IPL" depends="clean,copy-external,compile,javadoc" />

    <property name="src" location="src" />
    <property name="tmp" location="tmp" />
    <property name="lib" location="lib" />
    <property name="external" location="external" />
    <property name="javadoc" location="javadoc" />
    <property name="sources" location="sources" />

    <!-- copy external dependancies to lib, including provided GAT -->
    <target name="copy-included">
        <mkdir dir="${lib}" />

        <copy todir="${lib}">
            <fileset dir="${external}" includes="*.jar" />
        </copy>

        <copy todir="${lib}/javagat">
            <fileset dir="${external}/javagat" />
        </copy>

        <copy todir="${lib}/ipl">
            <fileset dir="${external}/ipl" />
        </copy>
    </target>

    <!-- copy javaGAT specified by $GAT_LOCATION and IPL specified by $IPL_HOME  -->
    <target name="copy-external">
        <mkdir dir="${lib}" />

        <copy todir="${lib}">
            <fileset dir="${external}" includes="*.jar" />
        </copy>

        <copy todir="${lib}/javagat">
            <fileset dir="${gat}/lib" />
        </copy>

        <copy todir="${lib}/ipl">
            <fileset dir="${ipl}/lib" />
        </copy>
    </target>

    <!-- Compile -->
    <target name="compile">
        <mkdir dir="${tmp}" />
        <mkdir dir="${lib}" />

        <path id="default.classpath">
            <fileset dir="${lib}">
                <include name="*.jar" />
            </fileset>
            <fileset dir="${lib}/javagat">
                <include name="*.jar" />
            </fileset>
            <fileset dir="${lib}/ipl">
                <include name="*.jar" />
            </fileset>
            <pathelement path="${tmp}" />
        </path>

        <!-- Compile the java code from ${src} into ${tmp} -->
        <javac srcdir="${src}" destdir="${tmp}" debug="on" source="1.5" target="1.5" classpathref="default.classpath">
            <compilerarg value="-Xlint:unchecked" />
        </javac>

        <!-- Create jar file -->
        <jar destfile="${lib}/${dist-name}.jar" basedir="${tmp}" includes="**/*.class">
        </jar>
        <delete dir="${tmp}" />

    </target>

    <!-- Generate javadoc -->
    <target name="javadoc" description="generate all javadocs">
        <javadoc destdir="${javadoc}" access="public" classpathref="default.classpath" packagenames="*" sourcepath="${src}" windowtitle="Ibis ${ant.project.name} Documentation" doctitle="Ibis ${ant.project.name} Documentation" bottom="The Ibis project">
            <link href="http://java.sun.com/j2se/1.5.0/docs/api/" />
        </javadoc>
    </target>

    <!-- Clean up everything -->
    <target name="clean" description="Clean up">
        <delete dir="${tmp}" />
        <delete dir="${lib}" />
        <delete dir="${javadoc}" />
    </target>

</project>
