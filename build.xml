<project name="deploy" default="build" basedir=".">
    <description>
	Build file for the deploy project
    </description>

    <property name="version" value="" />

    <property name="dist-name" value="${ant.project.name}${version}" />
    <property name="lib-jar" value="deploy${version}.jar" />
    <property name="gui-jar" value="deploy-gui${version}.jar" />
    <property name="cli-jar" value="deploy-cli${version}.jar" />

    <!-- Import environment properties -->

    <property name="ipl" location="external/ipl" />
    <property name="javagat" location="external/javagat" />
    <property name="zorilla" location="external/zorilla" />

    <target name="build" description="Build with included JavaGAT and IPL" depends="clean,copy-external,compile" />

    <!-- copy external dependancies -->
    <target name="copy-external">
        <mkdir dir="lib" />

        <!-- ipl -->

        <copy todir="lib/ipl">
            <fileset dir="${ipl}" />
        </copy>

        <!-- javagat -->

        <copy todir="lib/javagat">
            <fileset dir="${javagat}" />
        </copy>

        <!-- zorilla (main lib dir only) -->
        <copy todir="lib/zorilla">
            <fileset dir="${zorilla}" includes="*.jar" />
        </copy>

        <!-- other, and ipl apps -->
        <copy todir="lib">
            <fileset dir="external" includes="*.jar,ipl-apps" />
        </copy>

    </target>


    <!-- Compile -->
    <target name="compile">
        <mkdir dir="tmp" />
        <mkdir dir="tmp/images" />
        <mkdir dir="lib" />

        <path id="default.classpath">
            <fileset dir="lib">
                <include name="*.jar" />
            </fileset>
            <fileset dir="lib/javagat">
                <include name="*.jar" />
            </fileset>
            <fileset dir="lib/ipl">
                <include name="*.jar" />
            </fileset>
            <fileset dir="lib/zorilla">
                <include name="*.jar" />
            </fileset>
            <pathelement path="tmp" />
        </path>

        <copy todir="tmp/images">
            <fileset dir="images" includes="*" />
        </copy>

        <!-- Compile the java code from ${src} into ${tmp} -->
        <javac srcdir="src" destdir="tmp" debug="on" source="1.5" target="1.5" classpathref="default.classpath">
            <compilerarg value="-Xlint:unchecked" />
        </javac>

        <!-- Create jar file -->
        <jar destfile="lib/${lib-jar}" basedir="tmp" includes="ibis/deploy/*.class">
        </jar>

        <!-- Create jar file -->
        <jar destfile="lib/${gui-jar}" basedir="tmp" includes="ibis/deploy/gui/**/*.class,images/*">
        </jar>

        <!-- Create jar file -->
        <jar destfile="lib/${cli-jar}" basedir="tmp" includes="ibis/deploy/cli/**/*.class">
        </jar>

        <!-- Generate javadoc -->
        <javadoc destdir="javadoc" access="public" classpathref="default.classpath" packagenames="ibis.deploy" sourcepath="src" windowtitle="Ibis ${ant.project.name} Documentation" doctitle="Ibis ${ant.project.name} Documentation" bottom="The Ibis project">
            <link href="http://java.sun.com/j2se/1.5.0/docs/api/" />
        </javadoc>

        <delete dir="tmp" />

        <mkdir dir="lib-server" />

        <copy todir="lib-server">
            <fileset dir="lib/ipl" includes="commons*,ibis*,ipl*,jstun*,log4j*,sbbi*,slf4j*,smartsockets*,trilead*" />
        </copy>

        <mkdir dir="lib-zorilla" />

        <copy todir="lib-zorilla">
            <fileset dir="lib/ipl" />
            <fileset dir="lib/javagat" includes="*.jar,adaptors/LocalAdaptor/*,adaptors/SshTrileadAdaptor/*,adaptors/shared/*" />
            <fileset dir="lib/zorilla" />
        </copy>

    </target>

    <!-- Clean up everything -->
    <target name="clean" description="Clean up">
        <delete dir="tmp" />
        <delete dir="lib" />
        <delete dir="lib-server" />
        <delete dir="lib-zorilla" />
        <delete dir="javadoc" />
    </target>

</project>
